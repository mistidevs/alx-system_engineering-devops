# Google It: The (Fun) Anatomy of a Web Request and Response

## Prerequisites
This article assumes that the reader has some knowledge about the different levels of the web stack on the internet. As a result, the reader is encouraged to at least know about the existence of the levels of the web stack. Notwithstanding, since this article aims to appeal to all tech enthusiasts regardless of their expertise, it employs language that is easily understandable by a 7 year old. Yet, if jargon is used- as it must at times- a simple phrase or phrases explaining the word are employed soon after. Moreover, illustrations are employed to further enhance understanding.
Introduction
This article will focus on explaining the inner workings of the web request from a client to a server and the response of the server to the client. Think of it like asking for juice from the fruit barrister. The person (or people) asking is the client and the barrister is the server. The barrister may understand the request and give back to juice (200 OK). Or the juice may not be available (404 Not Found). Or the barrister may not have that juice at the moment and refer the client to another barrister temporarily (302 Moved Temporarily). Alternately, the barrister may not serve such juice and always redirect the client to another barrister (301 Moved Permanently). Or lastly, the barrister may have gone on a break and the client is talking to themselves (500 Server Error). 
For this article the focus will be on the in depth workings of typing google.com into a web browser and hitting enter. To enhance understanding there will be a juxtaposition of a child- Misti- looking for the book 'The Little Prince' knowing only the name of the room it should be in. As a result the web request and response will be covered in the following sections:
- DNS request
- TCP/IP
- Firewall
- HTTPS/SSL
- Load-balancer
- Web server
- Application server
- Database

The diagrammatic representation right below shows a snapshot of the exhilarating journey we will dive into.
![Typing google.com and hitting enter](https://imgur.com/a/XEakGGu)

## DNS Request
It all begins by opening a web browser of your choice and typing google.com and hitting enter. The web browser behind the scenes checks itself to see if it has a DNS (Domain Name Service) record that matches exactly the web page being requested. If it does, then the IP address is resolved and the DNS request is complete. However, this is an ideal case. In a slightly less ideal and more realistic case, the web browser does not have the DNS record hence it asks the operating system. At times the operating system has a cached DNS record of the site. However, this is often unlikely since operating systems as we entered the 21st Century ceased to store a DNS record of every website in local storage. This was due to the rapid growth in the number of websites that were populating the website.
Hence, in the realistic average case is that the web browser sends a request to a DNS server attaching the name of the web page to locate. The DNS server then takes it upon itself to search its own records and seek to locate the IP address of the requested web page. In the case it does not find the IP address, it proceeds to request name servers to yield the IP address of the web page requested. It is at this point the name servers either return the IP address or declare that such a web page does not exist. In the case the web page does not exist then the DNS server tells the web browser that the resource does not exist and an error is displayed for the user to check if there is a typo in their request. Notwithstanding, since we know that google is an actual web page the name server returns the IP address of the web page to the DNS server which returns it to the web browser. The web browser then seeks the resolved IP address. In this case, it could easily be 172.217.170.206 . And of course as is common it is on port 80.
Similarly, Misti goes up to the reception counter and asks for the room with the best children's books. The receptionist tries to recall the name of the room yet is not able to remember accurately. As a result they key into a computer the request of Misti. However, the system hasn't indexed (it does not know yet about the room) such a room. As a result, the receptionist calls someone they know who deals with this type of books. And sure enough they know the room. The room is R539. The receptionist also informs the people guarding the room that they should except a child called Misti.

## TCP/IP
The web browser having acquired the IP address seeks to locate the server with the resolved IP address. At this point, the IP address could resolve to a firewall or an ICMP (Internet Control Message Protocol) message could be sent indicating that the network either cannot be reached or does not exist. In our case, the IP address will forward to the firewall.
For Misti, he engages in walking all the way to room R539. Once at the door, the next stage begins.

## Firewall
If the client is not allowed to visit google.com then the router firewall will prevent the resolved IP address from going to the network path. This means that it is done and dusted for this client. They can never google again.
However, this is not likely thus the host firewall is what the client's web browser contends with. The web browser provides its credentials and metadata showing that it has implemented the proper and required protocols to be able to securely access the website. It verifies that is not an insecure instance that will attempt to hack into the the web pages server and database to divulge sensitive data. Our web browser is up to date thus the firewall finds that it can trust the web browser and allows it to communicate with the load balancer.
For Misti, once he arrives at room R539 it is quickly ascertained by the guards after a small interview that he is who he says he is and it is safe to let him inside.

## HTTPS/SSL
If the web browser sends a HTTP (Hyper Text Transfer Protocol) request to the load balancer which is only accepting HTTPS (Hyper Text Transfer Protocol Secure) traffic then the HTTP request will be upgraded to a HTTPS request. The benefit of this is that requests and responses are encrypted thus an attacker is not able to decode the request and response without the special public and private keys. Hence all traffic is safe. SSL (Secure Sockets Layer) ensures that the load balancer/server provides proof that it is who it says it is and not some wannabe impersonating the actual Google website.
If it is a wannabe the web browser will catch the load balancer/server in the act of impersonation and inform the user that the website cannot verify its identity hence it is not accessible due to security concerns. However, in the common case that the SSL certificate is valid the web browser will consent to the connection and the request is sent in encrypted format to the load balancer.
Once Misti is let in, he is given a card with special code that he should say to get the exact location of the book. This is the ISBN. To a random person the string of numbers make no sense. On top of that, he is told that only the person who tells him a special series of characters is the library expert who will help him. He, thus, asks everyone around him until he finds the expert who knows the coded words. He hands over the ISBN and is directed to a centralised place with the call number of the book written down.

## Load Balancer
The load balancer works by directing traffic to web servers that handle serving web pages. This could happen using round robin where the balancer hands out jobs evenly to every server. Or it could be task based such that certain servers handle certain request types. Or it could be computational power based where more powerful servers handle more of the traffic. Once the web browser is handed into the able hands of the load balancer it is directed to the web server that will be able to serve it.
Misti heads to the book seeker's lobby with the call number in hand. The head library expert finds a free librarian to guide him.

## Web Server
At this point the web browser requests for the web page from the web server assigned to assist it. In some cases the web server can declare that the resource is not present and return a 404 error. Or it could have moved the resource temporarily to another link and it returns a 302 redirect. Or probably the resource is moved permanently to a new link and can only be accessed from there hence a 301 redirect is sent. In some rare cases where the web server is overwhelmed it can send the 500 family of error messages that detail the exact server error from a bad gateway, to the server crashing or too much traffic for the server.
However, since Google's servers are robust (or so we want to believe) and the web page google.com exists we expect a 200 OK response. Yet the response does not come alone. As a result, the web server calls on the application server to deliver the goods after it has read HTML (Hypertext Markup Language), CSS (Cascading Style Sheets) and JavaScript from the code base.
Misti, gets a librarian who is capable and knows exactly where to go. Once they arrive at the book shelf the librarian calls on a library technician to deliver a device to aid in the exploration of the shelf with the family of call numbers for the book 'The Little Prince'.

## Application Server
The application server works on piecing together the web page based on a HTML template premade exactly for this job. The application server also retrieves all the necessary JavaScript and CSS code that will make the web page functional and visually appealing. These are passed on to the application server by the web server.
Moreover, the database is also called upon to yield specific data like the profile name and picture. The recent search history and an algorithm based on this is also spun up. The next star is the database.
The librarian aiding Misti receives a stool from the technician and they step right up. However, there are plenty of books with the same prefixated call number. Hence, there is need to refer afresh to the specific code for 'The Little Prince'.

## Database
The database uses some SQL (Structured Query Language) magic upon the request of the web server to retrieve the needed data for the user requesting the web page. This involves using a SELECT statement that retrieves the name, profile picture, search history and other relevant data for the user. It then returns it to the application server.
Once the librarian has clarified the exact code of the book she locates it on the shelf and picks it.

## The Response
Once the database handed data to the application server, the application servers knit the data into a beautiful and visually appealing web page which is handed to the web server. The web server gladly returns the content to the load balancer which locates the particular client that made the request and transmits the web page over. The web browser receives the bytes of data and works on reconstructing a visual representation of the web page for the user to engage with and view. 
On average, this process barely takes a few seconds, at most. In the period you took to read this article the Google web servers have resolved thousands if not millions of requests to google.com all without breaking a circuit.
For Misti, the librarian hands the book right to him and he cracks it open. He sinks into a bean bag chair and proceeds to enjoy reading the inked letters on paper similar to the way the user enjoys the pixels on their screen.

## Conclusion
The journey from typing google.com and hitting enter to enjoying the vibrant web page is a fascinating expedition through the intricate layers of the internet. Like Misti seeking 'The Little Prince' in a vast library, a web request embarks on a multi-step adventure involving DNS requests, TCP/IP, firewalls, HTTPS/SSL, load balancers, web servers, application servers, and databases.
Just as Misti navigates through the library, facing challenges and seeking assistance at each step, the web browser traverses various stages, from resolving DNS records to navigating firewalls and encryption protocols. The load balancer orchestrates the traffic, much like the librarian guiding Misti to the right section. The web server and application server collaborate to craft a visually appealing web page, akin to the librarian using a coded system to locate 'The Little Prince.'
In both scenarios, meticulous processes unfold to fulfill a request - be it for information on the web or a cherished book. The parallel narratives emphasize the complexity and teamwork involved in seamlessly delivering content to users. Google's servers, like the efficient library staff, handle myriad requests swiftly, ensuring users can access information without a hitch.
As Misti delves into the pages of 'The Little Prince,' the web user immerses themselves in the pixels on their screen - both experiencing the joy of discovery. The web, much like a well-organized library, showcases the harmonious interplay of technology, security, and efficiency, making the vast digital landscape accessible to users worldwide. So, whether exploring the virtual realms of the internet or the tangible shelves of a library, the quest for knowledge remains an enchanting adventure.
